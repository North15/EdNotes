{"version":3,"file":"ednotes.richtext.umd.min.js","sources":["../src/EdNotes.RichText/wwwroot/editor/core/Schema.js","../src/EdNotes.RichText/wwwroot/editor/core/Normalizer.js","../src/EdNotes.RichText/wwwroot/editor/core/Selection.js","../src/EdNotes.RichText/wwwroot/editor/core/CommandBus.js","../src/EdNotes.RichText/wwwroot/editor/ednotes.richtext.bundle.js"],"sourcesContent":["// Core schema definition (V1) â€“ no media, strict allowlist.\r\nexport const ALLOWED_BLOCKS = new Set(['p','h1','h2','h3','ul','ol','li','blockquote','pre','code','hr','table','thead','tbody','tr','th','td','span']);\r\nexport const ALLOWED_MARKS = new Set(['strong','em','u','a']);\r\nexport const ALLOWED_ATTRS = new Set(['href','target','rel','colspan','rowspan','data-list','data-checked','class']);\r\nexport const LINK_PROTOCOL_ALLOW = /^(https?:|mailto:|tel:)/i;\r\n\r\nexport function isAllowedTag(tag){ tag = tag.toLowerCase(); return ALLOWED_BLOCKS.has(tag) || ALLOWED_MARKS.has(tag); }\r\n\r\nexport function enforceLinkPolicy(a){\r\n  if(!a.getAttribute('href')) return;\r\n  let href = a.getAttribute('href');\r\n  // Trim leading/trailing whitespace\r\n  const originalHref = href;\r\n  href = href.trim();\r\n  // Decode once to catch simple encoded javascript: patterns\r\n  try { href = decodeURIComponent(href); } catch(_) { /* ignore decode issues */ }\r\n  // Explicitly block javascript: (any casing) after trimming/decoding\r\n  if(/^javascript:/i.test(href)) { \r\n    a.removeAttribute('href'); \r\n    a.setAttribute('target','_blank');\r\n    a.setAttribute('rel','noopener noreferrer');\r\n    return; \r\n  }\r\n  if(!LINK_PROTOCOL_ALLOW.test(href)) { \r\n    a.removeAttribute('href'); \r\n    a.setAttribute('target','_blank');\r\n    a.setAttribute('rel','noopener noreferrer');\r\n    return; \r\n  }\r\n  if(href !== originalHref) a.setAttribute('href', href);\r\n  a.setAttribute('target','_blank');\r\n  a.setAttribute('rel','noopener noreferrer');\r\n}\r\n","import { isAllowedTag, ALLOWED_ATTRS, enforceLinkPolicy } from './Schema.js';\r\n\r\nexport function normalize(root){\r\n  const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, null);\r\n  const toRemove = [];\r\n  while(walker.nextNode()){\r\n    const el = walker.currentNode;\r\n    const tag = el.tagName.toLowerCase();\r\n  if(tag === 'script' || tag === 'iframe') { toRemove.push(el); continue; }\r\n  // Remove any embedded script/iframe children early\r\n  el.querySelectorAll && el.querySelectorAll('script,iframe').forEach(child=> child.remove());\r\n    if(!isAllowedTag(tag)){\r\n      if(el.childNodes.length){\r\n        while(el.firstChild) el.parentNode.insertBefore(el.firstChild, el);\r\n      }\r\n      toRemove.push(el);\r\n      continue;\r\n    }\r\n    // Strip disallowed attributes (including style)\r\n    for(const attr of Array.from(el.attributes)){\r\n      const name = attr.name.toLowerCase();\r\n      if(name === 'style' || !ALLOWED_ATTRS.has(name)) el.removeAttribute(attr.name);\r\n    }\r\n    if(el.getAttribute && el.getAttribute('style')) el.removeAttribute('style');\r\n    if(/h[1-6]/.test(tag) && el.getAttribute && el.getAttribute('style')) el.removeAttribute('style');\r\n    if(tag === 'a') enforceLinkPolicy(el);\r\n    if(tag === 'ul' && el.getAttribute('data-list') === 'task'){\r\n      el.querySelectorAll('li').forEach(li=>{ if(!li.hasAttribute('data-checked')) li.setAttribute('data-checked','false'); });\r\n    }\r\n    if(tag === 'span' && el.classList.contains('math')){\r\n      // Allow math spans but sanitize content\r\n      el.textContent = el.textContent.replace(/[<>&]/g, ''); // Basic sanitization\r\n    }\r\n    if(tag === 'table'){\r\n      // Ensure structure: table>thead?+tbody? allowed; move stray tr into tbody\r\n      const rows=[...el.children].filter(c=> c.tagName && c.tagName.toLowerCase()==='tr');\r\n      if(rows.length){\r\n        let tbody=el.querySelector('tbody'); if(!tbody){ tbody=document.createElement('tbody'); el.appendChild(tbody); }\r\n        rows.forEach(r=> tbody.appendChild(r));\r\n      }\r\n      // Remove disallowed descendants\r\n      [...el.querySelectorAll('*')].forEach(child=>{\r\n        const ct = child.tagName.toLowerCase();\r\n        if(!['table','thead','tbody','tr','th','td'].includes(ct)) child.remove();\r\n      });\r\n    }\r\n  }\r\n  toRemove.forEach(n=> n.remove());\r\n  // Final sweep: remove any lingering style attributes\r\n  root.querySelectorAll && root.querySelectorAll('[style]').forEach(el=> el.removeAttribute('style'));\r\n}\r\n","// Lightweight selection bookmark utilities.\r\nexport function captureBookmark(root){\r\n  const sel = document.getSelection();\r\n  if(!sel || sel.rangeCount===0) return null;\r\n  const range = sel.getRangeAt(0);\r\n  return { anchor: pathTo(root, range.startContainer, range.startOffset), focus: pathTo(root, range.endContainer, range.endOffset) };\r\n}\r\n\r\nexport function restoreBookmark(root, bookmark){\r\n  if(!bookmark) return;\r\n  const sel = document.getSelection(); if(!sel) return;\r\n  const range = document.createRange();\r\n  const anchor = nodeFromPath(root, bookmark.anchor); const focus = nodeFromPath(root, bookmark.focus);\r\n  if(!anchor || !focus) return;\r\n  range.setStart(anchor.node, Math.min(bookmark.anchor.offset, anchor.nodeLength));\r\n  range.setEnd(focus.node, Math.min(bookmark.focus.offset, focus.nodeLength));\r\n  sel.removeAllRanges(); sel.addRange(range);\r\n}\r\n\r\nfunction pathTo(root, node, offset){\r\n  const path=[]; let n=node;\r\n  while(n && n!==root){ const parent=n.parentNode; if(!parent) break; const idx=Array.prototype.indexOf.call(parent.childNodes,n); path.push(idx); n=parent; }\r\n  return { indexes:path, offset }; // indexes from leaf up\r\n}\r\nfunction nodeFromPath(root, info){ if(!info) return null; let node=root; const rev=[...info.indexes]; while(rev.length){ const idx=rev.shift(); node = node.childNodes[idx]; if(!node) return null; } const TEXT = (typeof Node!=='undefined' && Node.TEXT_NODE) ? Node.TEXT_NODE : 3; return { node, nodeLength: node.nodeType===TEXT ? node.textContent.length : node.childNodes.length }; }\r\n","import { normalize } from './Normalizer.js';\r\nimport { captureBookmark, restoreBookmark } from './Selection.js';\r\n\r\nexport class CommandBus {\r\n  constructor(editor){ this.editor = editor; this._registry = new Map(); }\r\n  register(name, fn){ this._registry.set(name, fn); }\r\n  exec(name, opts){ const cmd=this._registry.get(name); if(!cmd) return false; this.editor._transaction((ed)=>cmd(ed, opts||{}));\r\n    if(name !== 'noop' && this.editor._live) {\r\n      const friendly = name.replace('strong','bold').replace('em','italic').replace('u','underline').replace('block:','heading ').replace('list:','list ').replace('link:','link ');\r\n      this.editor._live.textContent = `Applied ${friendly}`;\r\n    }\r\n    // Fire custom event so toolbar can refresh aria-pressed state immediately\r\n    try {\r\n      let ev;\r\n      if(typeof CustomEvent === 'function') ev = new CustomEvent('rtx-command', { bubbles:true, detail:{ name } });\r\n      else {\r\n        ev = document.createEvent('CustomEvent');\r\n        ev.initCustomEvent('rtx-command', true, false, { name });\r\n      }\r\n      this.editor.content.dispatchEvent(ev);\r\n    } catch(_) { /* non-fatal in headless */ }\r\n    return true; }\r\n}\r\n\r\nexport function markCommand(tag){\r\n  return (editor)=>{\r\n    // Prefer native execCommand when available (real browsers) for rich behavior (range merging, etc.)\r\n    const mapping = { strong:'bold', em:'italic', u:'underline' };\r\n    if(typeof document.execCommand === 'function' && mapping[tag]){\r\n      try { document.execCommand(mapping[tag]); return; } catch(_) { /* fall back */ }\r\n    }\r\n    // Fallback implementation (jsdom / non-rich environments): simple wrap / unwrap\r\n    const sel = document.getSelection();\r\n    if(!sel || sel.rangeCount===0 || sel.isCollapsed) return;\r\n    const range = sel.getRangeAt(0);\r\n    let startNode = range.startContainer;\r\n    while(startNode && startNode.nodeType===3) startNode = startNode.parentNode;\r\n    let endNode = range.endContainer;\r\n    while(endNode && endNode.nodeType===3) endNode = endNode.parentNode;\r\n    if(startNode === endNode && startNode && startNode.tagName && startNode.tagName.toLowerCase()===tag){\r\n      // Toggle off: unwrap\r\n      const el = startNode;\r\n      const frag = document.createDocumentFragment();\r\n      while(el.firstChild) frag.appendChild(el.firstChild);\r\n      el.parentNode.replaceChild(frag, el);\r\n      return;\r\n    }\r\n    const wrapper = document.createElement(tag);\r\n    wrapper.appendChild(range.extractContents());\r\n    range.insertNode(wrapper);\r\n    // Reselect new contents\r\n    sel.removeAllRanges();\r\n    const nr = document.createRange(); nr.selectNodeContents(wrapper); sel.addRange(nr);\r\n  };\r\n}\r\n\r\nexport class EditorCore {\r\n  constructor(textarea, options){\r\n    this.textarea = textarea; this.options=options||{};\r\n    this.root = this._build();\r\n    this.content = this.root.querySelector('.rtx-content');\r\n    this.bus = new CommandBus(this);\r\n  // Ensure noop command exists for tests / internal refresh triggers\r\n  this.bus.register('noop', () => {});\r\n  this.history = { stack: [], index: -1, batching: false, lastTypeTs: 0, limit: (this.options.historyLimit||100) };\r\n    this._setInterval = this.options._setInterval || setInterval;\r\n    if(this.options.autosaveIntervalMs){\r\n      this._autosaveTimer = this._setInterval(()=>{\r\n        const val = this.serialize();\r\n        if(this._lastAutosaveValue !== val){\r\n          this._lastAutosaveValue = val;\r\n          if(typeof this.options.onAutosave === 'function') this.options.onAutosave(val);\r\n        }\r\n      }, this.options.autosaveIntervalMs);\r\n    }\r\n    this._wire();\r\n  }\r\n  _build(){\r\n    const w=document.createElement('div'); w.className='rtx-editor';\r\n    const tb=document.createElement('div'); tb.className='rtx-toolbar'; tb.setAttribute('role','toolbar'); tb.setAttribute('aria-label','Formatting toolbar');\r\n    const c=document.createElement('div'); c.className='rtx-content'; c.contentEditable='true'; c.setAttribute('role','textbox'); c.setAttribute('aria-multiline','true');\r\n  const live=document.createElement('div'); live.className='rtx-live'; live.setAttribute('aria-live','polite'); live.style.position='absolute'; live.style.left='-9999px'; live.style.height='1px'; live.style.overflow='hidden';\r\n  w.appendChild(tb); w.appendChild(c); w.appendChild(live); this._live=live; this.textarea.style.display='none'; this.textarea.parentNode.insertBefore(w, this.textarea.nextSibling); return w;\r\n  }\r\n  _wire(){\r\n    // Input (typing) -> transactional with batching\r\n    this.content.addEventListener('input', ()=> {\r\n      const now = performance.now();\r\n      const gap = now - this.history.lastTypeTs;\r\n      const shouldNewEntry = gap > 600; // simple idle threshold\r\n  this._transaction(()=>{}, { pushHistory: shouldNewEntry });\r\n      this.history.lastTypeTs = now;\r\n    });\r\n    // Paste pipeline\r\n    this.content.addEventListener('paste', e => {\r\n      e.preventDefault();\r\n      const html = e.clipboardData && e.clipboardData.getData('text/html');\r\n      const text = e.clipboardData && e.clipboardData.getData('text/plain');\r\n      this._transaction(()=>{\r\n        if(html) {\r\n          const frag = document.createElement('div');\r\n          frag.innerHTML = html;\r\n          normalize(frag); // clean before insert\r\n          this._insertFragmentAtSelection(frag);\r\n        } else if(text) {\r\n          document.execCommand('insertText', false, text);\r\n        }\r\n      }, { pushHistory: true });\r\n    });\r\n    // Keyboard shortcuts\r\n    this.content.addEventListener('keydown', e => {\r\n      const mod = e.metaKey || e.ctrlKey;\r\n      const key = e.key.toLowerCase();\r\n      \r\n      // Task list toggle with Enter or Space\r\n      if((key === 'enter' || key === ' ') && !mod){\r\n        const sel = document.getSelection();\r\n        if(sel.rangeCount > 0){\r\n          let node = sel.anchorNode;\r\n          while(node && node !== this.content){\r\n            if(node.nodeType === 1 && node.tagName.toLowerCase() === 'li'){\r\n              const ul = node.parentNode;\r\n              if(ul && ul.tagName.toLowerCase() === 'ul' && ul.getAttribute('data-list') === 'task'){\r\n                e.preventDefault();\r\n                const current = node.getAttribute('data-checked') === 'true' ? 'true' : 'false';\r\n                const next = current === 'true' ? 'false' : 'true';\r\n                node.setAttribute('data-checked', next);\r\n                this._pushHistory();\r\n                return;\r\n              }\r\n            }\r\n            node = node.parentNode;\r\n          }\r\n        }\r\n      }\r\n      \r\n      if(mod && key === 'z'){ // undo / redo\r\n        e.preventDefault();\r\n        if(e.shiftKey) this.redo(); else this.undo();\r\n        return;\r\n      }\r\n      if(mod && (key === 'b' || key==='i' || key==='u')){ // formatting\r\n        e.preventDefault();\r\n        const map = { b:'strong', i:'em', u:'u' };\r\n        this.bus.exec(map[key]);\r\n        return;\r\n      }\r\n      if(mod && e.altKey && ['0','1','2','3'].includes(e.key)){\r\n        e.preventDefault();\r\n        const hMap = { '0':'p', '1':'h1', '2':'h2', '3':'h3' };\r\n        this.bus.exec('block:'+hMap[e.key]);\r\n        return;\r\n      }\r\n      if(key === 'tab'){\r\n        if(this._maybeHandleListIndent(e)) return; // prevent default inside handler\r\n      }\r\n    });\r\n    this.content.innerHTML = this.textarea.value || '<p></p>';\r\n    this._pushHistory();\r\n  }\r\n  _transaction(worker, opts={}){\r\n    const bm = captureBookmark(this.content);\r\n    worker(this);\r\n    normalize(this.content);\r\n    restoreBookmark(this.content, bm);\r\n    this.textarea.value = this.serialize();\r\n    if(typeof this.options.onChange === 'function') this.options.onChange(this.textarea.value);\r\n    if(opts.pushHistory) this._pushHistory();\r\n  }\r\n  _pushHistory(){\r\n    // Truncate redo tail\r\n    if(this.history.index < this.history.stack.length -1){\r\n      this.history.stack = this.history.stack.slice(0, this.history.index+1);\r\n    }\r\n    this.history.stack.push({ html: this.serialize() });\r\n    this.history.index = this.history.stack.length -1;\r\n    if(this.history.stack.length > this.history.limit){\r\n      // Drop oldest\r\n      const overflow = this.history.stack.length - this.history.limit;\r\n      this.history.stack.splice(0, overflow);\r\n      this.history.index -= overflow;\r\n    }\r\n  }\r\n  undo(){\r\n    if(this.history.index <=0) return;\r\n    this.history.index--;\r\n    this._restoreHistoryEntry();\r\n  }\r\n  redo(){\r\n    if(this.history.index >= this.history.stack.length -1) return;\r\n    this.history.index++;\r\n    this._restoreHistoryEntry();\r\n  }\r\n  _restoreHistoryEntry(){\r\n    const entry = this.history.stack[this.history.index];\r\n    if(!entry) return;\r\n    this.content.innerHTML = entry.html;\r\n    normalize(this.content);\r\n    this.textarea.value = this.serialize();\r\n  }\r\n  _insertFragmentAtSelection(frag){\r\n    const sel = document.getSelection(); if(!sel || sel.rangeCount===0) return;\r\n    const range = sel.getRangeAt(0); range.deleteContents();\r\n    while(frag.firstChild){ range.insertNode(frag.firstChild); }\r\n    // Move caret to end of inserted content\r\n    sel.collapse(range.endContainer, range.endOffset);\r\n  }\r\n  _maybeHandleListIndent(e){\r\n    // Returns true if handled\r\n    const sel = document.getSelection();\r\n    if(!sel || sel.rangeCount===0) return false;\r\n    let node = sel.getRangeAt(0).startContainer;\r\n    while(node && node !== this.content && node.nodeType===3) node = node.parentNode;\r\n    while(node && node.tagName && node.tagName.toLowerCase() !== 'li' && node !== this.content) node = node.parentNode;\r\n    if(!node || node===this.content) return false;\r\n    const li = node;\r\n    const list = li.parentNode;\r\n    if(e.shiftKey){ // outdent\r\n      const parentLi = list.parentNode && list.parentNode.tagName && list.parentNode.tagName.toLowerCase()==='li' ? list.parentNode : null;\r\n      e.preventDefault();\r\n      if(parentLi){\r\n      const ancestorList = parentLi.parentNode; // ul/ol\r\n      ancestorList.insertBefore(li, parentLi.nextSibling);\r\n      if(list.children.length===0) list.remove();\r\n      this._transaction(()=>{}, { pushHistory: true });\r\n      return true;\r\n      } else if(list.parentNode === this.content){\r\n      // Already top-level: no action\r\n      return false;\r\n      }\r\n      return false;\r\n    } else { // indent\r\n      const prev = li.previousElementSibling;\r\n      if(!prev) return false; // cannot indent first\r\n      e.preventDefault();\r\n      let sublist = Array.from(prev.children).reverse().find(ch => ch.tagName && (ch.tagName.toLowerCase()==='ul' || ch.tagName.toLowerCase()==='ol'));\r\n      if(!sublist){\r\n        sublist = document.createElement(list.tagName.toLowerCase());\r\n        prev.appendChild(sublist);\r\n      }\r\n      sublist.appendChild(li);\r\n      this._transaction(()=>{}, { pushHistory: true });\r\n      return true;\r\n    }\r\n  }\r\n  serialize(){ return this.content.innerHTML; }\r\n  triggerSave(){ this.textarea.value = this.serialize(); }\r\n  exportPlainText(){\r\n    // Basic block separation by newlines\r\n    const clone = this.content.cloneNode(true);\r\n    clone.querySelectorAll('script,style').forEach(n=> n.remove());\r\n    return clone.textContent.replace(/\\n{2,}/g,'\\n').trim();\r\n  }\r\n  exportMarkdown(){\r\n    // Ultra-minimal mapping\r\n    const out=[];\r\n    for(const child of this.content.children){\r\n      const tag=child.tagName.toLowerCase();\r\n      let line='';\r\n      if(tag==='p') line = child.textContent.trim();\r\n      else if(/^h[1-6]$/.test(tag)) line = '#'.repeat(parseInt(tag[1])) + ' ' + child.textContent.trim();\r\n      else if(tag==='ul'){\r\n        child.querySelectorAll(':scope > li').forEach(li=> out.push('- '+li.textContent.trim()));\r\n        continue;\r\n      } else if(tag==='ol'){\r\n        let i=1; child.querySelectorAll(':scope > li').forEach(li=> out.push((i++)+'. '+li.textContent.trim()));\r\n        continue;\r\n      } else line = child.textContent.trim();\r\n      out.push(line);\r\n    }\r\n    return out.join('\\n\\n');\r\n  }\r\n  exportHTML(){\r\n    return this.content.innerHTML;\r\n  }\r\n  dispose(){ if(this._autosaveTimer) clearInterval(this._autosaveTimer); }\r\n}\r\n","// Primary public bundle entry for EdNotes Rich Text Editor.\r\n// Exports all public API symbols (previous legacy yourorg bundle removed in 0.2.0).\r\nimport { EditorCore, markCommand } from './core/CommandBus.js';\r\nimport { enforceLinkPolicy } from './core/Schema.js';\r\nimport katex from 'katex';\r\n\r\n// Minimal facade replicating prior RichText export shape.\r\nconst instances = new Set();\r\nfunction _all(){ return Array.from(instances); }\r\n\r\nfunction mountToolbar(editor){\r\n\tconst tb = editor.root.querySelector('.rtx-toolbar');\r\n\tif(!tb) return;\r\n\tconst buttons = [\r\n\t\t{ label:'B', aria:'Bold', cmd:'strong', mark:'strong' },\r\n\t\t{ label:'I', aria:'Italic', cmd:'em', mark:'em' },\r\n\t\t{ label:'U', aria:'Underline', cmd:'u', mark:'u' },\r\n\t\t{ label:'P', aria:'Paragraph', cmd:'block:p', block:'p' },\r\n\t\t{ label:'H1', aria:'Heading 1', cmd:'block:h1', block:'h1' },\r\n\t\t{ label:'H2', aria:'Heading 2', cmd:'block:h2', block:'h2' },\r\n\t\t{ label:'H3', aria:'Heading 3', cmd:'block:h3', block:'h3' },\r\n\t\t{ label:'â€¢', aria:'Bullet List', cmd:'list:ul', list:'ul' },\r\n\t\t{ label:'1.', aria:'Numbered List', cmd:'list:ol', list:'ol' },\r\n\t\t{ label:'ðŸ”—', aria:'Add Link', cmd:'link:add' },\r\n\t\t{ label:'âœ–', aria:'Remove Link', cmd:'link:remove' },\r\n\t\t{ label:'â˜‘', aria:'Task List', cmd:'list:task' },\r\n\t\t{ label:'âˆ‘', aria:'Math Equation', cmd:'math:add' }\r\n\t];\r\n\tconst btnEls=[];\r\n\tbuttons.forEach((b,i)=>{\r\n\t\tconst btn=document.createElement('button');\r\n\t\tbtn.type='button'; btn.textContent=b.label; btn.setAttribute('aria-label',b.aria); btn.dataset.cmd=b.cmd; btn.tabIndex = i===0?0:-1;\r\n\t\tbtn.addEventListener('click',()=> editor.bus.exec(b.cmd));\r\n\t\tbtn.addEventListener('keydown', e=>{\r\n\t\t\tif(e.key==='ArrowRight'||e.key==='ArrowLeft'){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tconst dir = e.key==='ArrowRight'?1:-1;\r\n\t\t\t\tlet idx = btnEls.indexOf(btn)+dir; if(idx<0) idx=btnEls.length-1; if(idx>=btnEls.length) idx=0;\r\n\t\t\t\tbtnEls.forEach(b2=> b2.tabIndex=-1); btnEls[idx].tabIndex=0; btnEls[idx].focus();\r\n\t\t\t}\r\n\t\t});\r\n\t\ttb.appendChild(btn); btnEls.push(btn);\r\n\t});\r\n}\r\n\r\nexport const RichText = {\r\n\tattach(selector, options={}){\r\n\t\tconst nodes = document.querySelectorAll(selector);\r\n\t\tif(nodes.length===0){\r\n\t\t\tconsole.warn('[EdNotes.RichText] No elements matched selector', selector);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tnodes.forEach(t=>{\r\n\t\t\tif(t._rtxAttached) return; t._rtxAttached=true;\r\n\t\t\tconst ed = new EditorCore(t, options);\r\n\t\t\ted.bus.register('strong', markCommand('strong'));\r\n\t\t\ted.bus.register('em', markCommand('em'));\r\n\t\t\ted.bus.register('u', markCommand('u'));\r\n\t\t\ted.bus.register('block:p', blockCommand('p'));\r\n\t\t\ted.bus.register('block:h1', blockCommand('h1'));\r\n\t\t\ted.bus.register('block:h2', blockCommand('h2'));\r\n\t\t\ted.bus.register('block:h3', blockCommand('h3'));\r\n\t\t\ted.bus.register('list:ul', listCommand('ul'));\r\n\t\t\ted.bus.register('list:ol', listCommand('ol'));\r\n\t\t\ted.bus.register('link:add', linkAddCommand(options));\r\n\t\t\ted.bus.register('link:remove', linkRemoveCommand());\r\n\t\t\ted.bus.register('list:task', taskListCommand());\r\n\t\t\ted.bus.register('math:add', mathCommand(options));\r\n\t\t\tmountToolbar(ed);\r\n\t\t\ted.root.setAttribute('data-rtx-attached','true');\r\n\t\t\tt.setAttribute('data-rtx-source','true');\r\n\t\t\tinstances.add(ed);\r\n\t\t});\r\n\t\treturn nodes.length;\r\n\t},\r\n\ttriggerSave(){ instances.forEach(i=> i.triggerSave()); },\r\n\tundo(){ instances.forEach(i=> i.undo()); },\r\n\tredo(){ instances.forEach(i=> i.redo()); },\r\n\texportAllPlain(){ return _all().map(i=> i.exportPlainText()); },\r\n\texportAllMarkdown(){ return _all().map(i=> i.exportMarkdown()); },\r\n\texportAllHTML(){ return _all().map(i=> i.exportHTML()); },\r\n\tenforceLinkPolicy,\r\n\t_all,\r\n\t_clearInstances: () => instances.clear(),\r\n};\r\n\r\n// Version injected manually (consider automated replacement in future build step)\r\n// Bump version for documentation/demo fixes (theme switching + demo content adjustments)\r\nRichText.version = '0.5.2';\r\n\r\nfunction blockCommand(tag){\r\n\treturn (ed)=>{\r\n\t\tconst sel = document.getSelection(); if(!sel || sel.rangeCount===0) return;\r\n\t\tconst range = sel.getRangeAt(0);\r\n\t\tlet node = range.startContainer;\r\n\t\twhile(node && node !== ed.content && node.nodeType === 3) node = node.parentNode;\r\n\t\twhile(node && node.parentNode !== ed.content) node = node.parentNode;\r\n\t\tif(!node) return;\r\n\t\tif(node.tagName && node.tagName.toLowerCase() === tag) return;\r\n\t\tconst replacement = document.createElement(tag);\r\n\t\treplacement.innerHTML = node.innerHTML || '<br />';\r\n\t\ted.content.replaceChild(replacement, node);\r\n\t};\r\n}\r\nfunction listCommand(listTag){\r\n\treturn (ed)=>{\r\n\t\tconst sel = document.getSelection(); if(!sel || sel.rangeCount===0) return;\r\n\t\tconst range = sel.getRangeAt(0);\r\n\t\tlet node = range.startContainer;\r\n\t\twhile(node && node !== ed.content && node.nodeType === 3) node = node.parentNode;\r\n\t\twhile(node && node.parentNode !== ed.content) node = node.parentNode;\r\n\t\tif(!node) return;\r\n\t\tconst tag = node.tagName ? node.tagName.toLowerCase() : '';\r\n\t\tif(tag === 'ul' || tag === 'ol'){\r\n\t\t\tconst frag = document.createDocumentFragment();\r\n\t\t\tArray.from(node.querySelectorAll('li')).forEach(li=>{\r\n\t\t\t\tconst p=document.createElement('p'); p.innerHTML = li.innerHTML || '<br />'; frag.appendChild(p);\r\n\t\t\t});\r\n\t\t\ted.content.replaceChild(frag, node);\r\n\t\t} else {\r\n\t\t\tconst list = document.createElement(listTag);\r\n\t\t\tconst li = document.createElement('li'); li.innerHTML = node.innerHTML || '<br />'; list.appendChild(li);\r\n\t\t\ted.content.replaceChild(list, node);\r\n\t\t}\r\n\t};\r\n}\r\nfunction linkAddCommand(options){\r\n\treturn (ed)=>{\r\n\t\tconst sel = document.getSelection(); if(!sel || sel.rangeCount===0) return;\r\n\t\tconst url = (options && options.promptLink)? options.promptLink() : (typeof window.prompt==='function'? window.prompt('Enter URL (https://...)','https://') : null);\r\n\t\tif(!url) return;\r\n\t\tconst a=document.createElement('a'); a.href=url; enforceLinkPolicy(a);\r\n\t\tconst range = sel.getRangeAt(0);\r\n\t\tif(range.collapsed){ a.textContent=url; range.insertNode(a); sel.collapse(a, a.childNodes.length); }\r\n\t\telse {\r\n\t\t\tconst txt=range.extractContents(); a.appendChild(txt); range.insertNode(a);\r\n\t\t}\r\n\t\ted.bus.exec('noop');\r\n\t};\r\n}\r\nfunction linkRemoveCommand(){\r\n\treturn (ed)=>{\r\n\t\tconst sel = document.getSelection(); if(!sel || sel.rangeCount===0) return;\r\n\t\tlet node = sel.anchorNode || sel.focusNode;\r\n\t\twhile(node && node!==ed.content && (!node.tagName || node.tagName.toLowerCase()!=='a')) node=node.parentNode;\r\n\t\tif(node && node.tagName && node.tagName.toLowerCase()==='a'){\r\n\t\t\tconst parent=node.parentNode; while(node.firstChild) parent.insertBefore(node.firstChild, node); node.remove();\r\n\t\t\ted._transaction(()=>{}, { pushHistory: true });\r\n\t\t}\r\n\t};\r\n}\r\nfunction taskListCommand(){\r\n\treturn (ed)=>{\r\n\t\tconst sel=document.getSelection(); if(!sel||sel.rangeCount===0) return;\r\n\t\tlet node=sel.anchorNode; while(node && node!==ed.content && node.nodeType===3) node=node.parentNode;\r\n\t\twhile(node && node.parentNode !== ed.content) node=node.parentNode;\r\n\t\tif(!node) return;\r\n\t\tconst tag=node.tagName?node.tagName.toLowerCase():'';\r\n\t\tif(tag==='ul' && node.getAttribute('data-list')==='task'){\r\n\t\t\tnode.removeAttribute('data-list'); node.querySelectorAll('li').forEach(li=> li.removeAttribute('data-checked'));\r\n\t\t} else if(tag==='ul') { node.setAttribute('data-list','task'); node.querySelectorAll('li').forEach(li=>{ if(!li.hasAttribute('data-checked')) li.setAttribute('data-checked','false'); }); }\r\n\t\telse {\r\n\t\t\tconst ul=document.createElement('ul'); ul.setAttribute('data-list','task');\r\n\t\t\tconst li=document.createElement('li'); li.setAttribute('data-checked','false'); li.innerHTML=node.innerHTML || '<br />'; ul.appendChild(li); ed.content.replaceChild(ul,node);\r\n\t\t}\r\n\t};\r\n}\r\nfunction mathCommand(options){\r\n\treturn (ed)=>{\r\n\t\tconst sel = document.getSelection(); if(!sel || sel.rangeCount===0) return;\r\n\t\tconst latex = (options && options.promptMath)? options.promptMath() : (typeof window.prompt==='function'? window.prompt('Enter LaTeX:','x^2') : null);\r\n\t\tif(!latex) return;\r\n\t\tconst span = document.createElement('span');\r\n\t\tspan.className = 'math';\r\n\t\tspan.textContent = latex;\r\n\t\ttry {\r\n\t\t\tkatex.render(latex, span, { throwOnError: false });\r\n\t\t} catch(e) {\r\n\t\t\tspan.textContent = '[Math Error]';\r\n\t\t}\r\n\t\tconst range = sel.getRangeAt(0);\r\n\t\trange.deleteContents();\r\n\t\trange.insertNode(span);\r\n\t\tsel.collapse(span.nextSibling || span, 0);\r\n\t\ted.bus.exec('noop');\r\n\t};\r\n}\r\nif(typeof window!== 'undefined') window.RichText = RichText;\r\n"],"names":["ALLOWED_BLOCKS","Set","ALLOWED_MARKS","ALLOWED_ATTRS","LINK_PROTOCOL_ALLOW","isAllowedTag","tag","toLowerCase","has","enforceLinkPolicy","a","getAttribute","href","originalHref","trim","decodeURIComponent","_","test","removeAttribute","setAttribute","normalize","root","walker","document","createTreeWalker","NodeFilter","SHOW_ELEMENT","toRemove","nextNode","el","currentNode","tagName","querySelectorAll","forEach","child","remove","attr","Array","from","attributes","name","li","hasAttribute","classList","contains","textContent","replace","rows","children","filter","c","length","tbody","querySelector","createElement","appendChild","r","ct","includes","childNodes","firstChild","parentNode","insertBefore","push","n","pathTo","node","offset","path","parent","idx","prototype","indexOf","call","indexes","nodeFromPath","info","rev","shift","TEXT","Node","TEXT_NODE","nodeLength","nodeType","CommandBus","constructor","editor","this","_registry","Map","register","fn","set","exec","opts","cmd","get","_transaction","ed","_live","friendly","ev","CustomEvent","bubbles","detail","createEvent","initCustomEvent","content","dispatchEvent","markCommand","mapping","strong","em","u","execCommand","sel","getSelection","rangeCount","isCollapsed","range","getRangeAt","startNode","startContainer","endNode","endContainer","frag","createDocumentFragment","replaceChild","wrapper","extractContents","insertNode","removeAllRanges","nr","createRange","selectNodeContents","addRange","EditorCore","textarea","options","_build","bus","history","stack","index","batching","lastTypeTs","limit","historyLimit","_setInterval","setInterval","autosaveIntervalMs","_autosaveTimer","val","serialize","_lastAutosaveValue","onAutosave","_wire","w","className","tb","contentEditable","live","style","position","left","height","overflow","display","nextSibling","addEventListener","now","performance","shouldNewEntry","pushHistory","e","preventDefault","html","clipboardData","getData","text","innerHTML","_insertFragmentAtSelection","mod","metaKey","ctrlKey","key","anchorNode","ul","next","_pushHistory","shiftKey","redo","undo","map","b","i","altKey","hMap","_maybeHandleListIndent","value","worker","bm","anchor","startOffset","focus","endOffset","captureBookmark","bookmark","setStart","Math","min","setEnd","restoreBookmark","onChange","slice","splice","_restoreHistoryEntry","entry","deleteContents","collapse","list","parentLi","prev","previousElementSibling","sublist","reverse","find","ch","triggerSave","exportPlainText","clone","cloneNode","exportMarkdown","out","line","repeat","parseInt","join","exportHTML","dispose","clearInterval","instances","_all","RichText","attach","selector","nodes","console","warn","t","_rtxAttached","blockCommand","listCommand","url","promptLink","window","prompt","collapsed","txt","linkAddCommand","focusNode","latex","promptMath","span","katex","render","throwOnError","mathCommand","btnEls","label","aria","mark","block","btn","type","dataset","tabIndex","dir","b2","mountToolbar","add","exportAllPlain","exportAllMarkdown","exportAllHTML","_clearInstances","clear","replacement","listTag","p","version"],"mappings":"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"}